<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MotoGear - –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@400;700&display=swap"
          rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding-top: 80px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Header */
        .header {
            background: #1a1a1a;
            color: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            font-family: 'Bebas Neue', cursive;
            font-size: 2rem;
            font-weight: bold;
        }

        .logo span {
            color: #ff6b35;
        }

        .nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav a {
            color: white;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .nav a:hover {
            color: #ff6b35;
        }

        .auth-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-left: 2rem;
            color: white;
        }

        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin-bottom: 20px;
            transition: background 0.3s;
            border: none;
            cursor: pointer;
            font-family: 'Roboto', sans-serif;
        }

        .back-button:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .product-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .product-details {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            body {
                padding-top: 120px;
            }
        }

        .product-images {
            position: relative;
        }

        .main-image {
            width: 100%;
            height: 400px;
            object-fit: contain;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 15px;
            background: #f8f9fa;
            padding: 20px;
        }

        .product-info {
            padding: 20px 0;
        }

        .product-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 2.5em;
            color: #1a1a1a;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }

        .product-price {
            font-size: 2.2em;
            color: #ff6b35;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .product-quantity {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 1.1em;
            margin-bottom: 25px;
            font-weight: bold;
        }

        .quantity-high {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .quantity-low {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .quantity-out {
            background: #f8d9db;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .product-description {
            margin-bottom: 30px;
            line-height: 1.8;
            color: #666;
            font-size: 1.1em;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #ff6b35;
        }

        .product-meta {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }

        .meta-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }

        .meta-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .meta-value {
            color: #666;
        }

        .order-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            margin-top: 30px;
        }

        .order-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.8em;
            color: #1a1a1a;
            margin-bottom: 20px;
            text-align: center;
        }

        .order-form {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid #ddd;
        }

        .qty-btn {
            width: 35px;
            height: 35px;
            border: none;
            background: #ff6b35;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qty-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .qty-input {
            width: 60px;
            text-align: center;
            border: none;
            font-size: 1.2em;
            font-weight: bold;
        }

        .add-to-cart-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .add-to-cart-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .add-to-cart-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
            text-align: center;
        }

        .footer {
            background: #1a1a1a;
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 40px;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
<!-- –®–∞–ø–∫–∞ -->
<header class="header">
    <div class="header-content">
        <div class="logo">Moto<span>Gear</span></div>
        <nav class="nav">
            <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a href="#" class="cart-icon">
                <span aria-hidden="true">üõí</span>
                <span class="sr-only">–ö–æ—Ä–∑–∏–Ω–∞</span>
                <span>(0)</span>
            </a>
        </nav>
        <div class="auth-section">
            <a href="/api/auth/login">–í–æ–π—Ç–∏</a>
            <span>|</span>
            <a href="/api/auth/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        </div>
    </div>
</header>

<div class="container">
    <button onclick="window.history.back()" class="back-button">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</button>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
    <div th:if="${error != null}" class="error-message">
        <p th:text="${error}">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ -->
    <div th:if="${product != null}">
        <div class="product-details">
            <div class="product-images">
                <img th:src="${product.imageUrl}"
                     th:alt="${product.name}"
                     class="main-image"
                     onerror="this.src='/images/placeholder-product.jpg'">
            </div>

            <div class="product-info">
                <h1 class="product-title" th:text="${product.name}">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</h1>
                <div class="product-price" th:text="'‚ÇΩ' + ${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')}">‚ÇΩ0</div>

                <!-- –°—Ç–∞—Ç—É—Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ -->
                <div th:classappend="${product.stockQuantity == 0} ? 'product-quantity quantity-out' :
                                    ${product.stockQuantity < 10} ? 'product-quantity quantity-low' :
                                    'product-quantity quantity-high'"
                     class="product-quantity">
                    <span th:if="${product.stockQuantity == 0}">‚ùå –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                    <span th:if="${product.stockQuantity > 0 and product.stockQuantity < 10}">
                        ‚ö†Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –≤—Å–µ–≥–æ: <span th:text="${product.stockQuantity}"></span> —à—Ç.
                    </span>
                    <span th:if="${product.stockQuantity >= 10}">
                        ‚úÖ –í –Ω–∞–ª–∏—á–∏–∏: <span th:text="${product.stockQuantity}"></span> —à—Ç.
                    </span>
                </div>

                <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                <div class="product-description">
                    <h3 style="margin-bottom: 10px; color: #333;">–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <p th:text="${product.description != null ? product.description : '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}">
                        –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
                    </p>
                </div>

                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="product-meta">
                    <div class="meta-item" th:if="${product.category != null}">
                        <div class="meta-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</div>
                        <div class="meta-value" th:text="${product.category.name}">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</div>
                    </div>

                    <div class="meta-item" th:if="${product.brand != null}">
                        <div class="meta-label">–ë—Ä–µ–Ω–¥</div>
                        <div class="meta-value" th:text="${product.brand}">–ë—Ä–µ–Ω–¥</div>
                    </div>

                    <div class="meta-item" th:if="${product.model != null}">
                        <div class="meta-label">–ú–æ–¥–µ–ª—å</div>
                        <div class="meta-value" th:text="${product.model}">–ú–æ–¥–µ–ª—å</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –∑–∞–∫–∞–∑–∞ -->
        <div class="order-section">
            <h3 class="order-title">–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑</h3>
            <div class="order-form">
                <div class="quantity-selector">
                    <button class="qty-btn" onclick="changeQuantity(-1)" th:disabled="${product.stockQuantity == 0}">-</button>
                    <input type="number" id="quantity" class="qty-input" value="1" min="1"
                           th:attr="max=${product.stockQuantity}"
                           onchange="validateQuantity()">
                    <button class="qty-btn" onclick="changeQuantity(1)" th:disabled="${product.stockQuantity == 0}">+</button>
                </div>
                <button class="add-to-cart-btn" onclick="addToOrder()"
                        th:disabled="${product.stockQuantity == 0}">
                    üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                </button>
            </div>
            <p style="text-align: center; margin-top: 15px; color: #666; font-size: 0.9em;">
                <span th:if="${product.stockQuantity == 0}">–¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                <span th:if="${product.stockQuantity > 0}">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –∑–∞–∫–∞–∑–∞: <strong th:text="${product.stockQuantity}"></strong> —à—Ç.</span>
            </p>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω -->
    <div th:if="${product == null and error == null}" class="error-message">
        <p>–ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –∫–∞—Ç–∞–ª–æ–≥ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Ç–æ–≤–∞—Ä.</p>
        <button onclick="window.location.href='/catalog'" class="back-button" style="margin-top: 10px;">
            –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
        </button>
    </div>
</div>

<!-- –§—É—Ç–µ—Ä -->
<footer class="footer">
    <div class="container">
        <p>¬© 2025 MotoGear. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    </div>
</footer>

<script>
    // –ü–æ–ª—É—á–∞–µ–º ID –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–∑ URL –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ JavaScript
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');
    const maxQuantity = [[${product != null ? product.stockQuantity : 0}]];

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
    function changeQuantity(delta) {
        const input = document.getElementById('quantity');
        let newValue = parseInt(input.value) + delta;

        if (newValue < 1) newValue = 1;
        if (newValue > maxQuantity) newValue = maxQuantity;

        input.value = newValue;
    }

    function validateQuantity() {
        const input = document.getElementById('quantity');
        let value = parseInt(input.value);

        if (isNaN(value) || value < 1) value = 1;
        if (value > maxQuantity) value = maxQuantity;

        input.value = value;
    }

    // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∑–∞–∫–∞–∑
    function addToOrder() {
        const quantity = document.getElementById('quantity').value;

        if (maxQuantity === 0) {
            alert('–≠—Ç–æ—Ç —Ç–æ–≤–∞—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏');
            return;
        }

        if (parseInt(quantity) > maxQuantity) {
            alert(`–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${maxQuantity} —à—Ç.`);
            validateQuantity();
            return;
        }

        // –ó–∞–≥–ª—É—à–∫–∞ - –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç API –∑–∞–ø—Ä–æ—Å
        alert(`–¢–æ–≤–∞—Ä "${document.querySelector('.product-title').textContent}" –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${quantity} —à—Ç.\n\n(–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)`);

        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
        // fetch('/api/order/add', {
        //     method: 'POST',
        //     headers: { 'Content-Type': 'application/json' },
        //     body: JSON.stringify({ productId: productId, quantity: quantity })
        // })
        // .then(response => response.json())
        // .then(data => {
        //     alert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!');
        //     updateCartCounter();
        // });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã (–∑–∞–≥–ª—É—à–∫–∞)
    function updateCartCounter() {
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –≤ —Ö–µ–¥–µ—Ä–µ
        console.log('–ö–æ—Ä–∑–∏–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
    document.getElementById('quantity').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            addToOrder();
        }
    });
</script>
</body>
</html>